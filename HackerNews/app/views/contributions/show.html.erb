<!-- item?id -> contributions/id -->
<html lang="en" op="item">
  <head>
    <meta name="referrer" content="origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheets" type="text/css" href="application.css">
    <link rel="shortcut icon" href="favicon.ico">
    <title> <%= @contribution.title %> | Hacker News</title>
  </head>
  
  <body>
    <center>
      <table id="hnmain" border="0" cellpadding="0" cellspacing="0" width="85%" bgcolor="#f6f6ef">
        
        <tr>
          <td bgcolor="#ff6600">
            <table border="0" cellpadding="0" cellspacing="0" width="100%" style="padding:2px">
              <tr>
                <td style="width:18px;padding-right:4px">
                  <a href=<%= contributions_path %>>
                    <%= image_tag("y18.gif", :width => "18", :height =>"18", :style =>"border:1px white solid;") %>
                  </a>
                </td>
                <td style="line-height:12pt; height:10px;">
                  <span class="pagetop">
                    <b class="hnname">
                      <a href=<%= contributions_path %>>Hacker News</a>
                    </b>
                    <a href=<%= newest_contributions_path %>>new</a>
                    |
                    <a href="<%= comments_path %>?threads=1">threads</a>
                    | 
                    <b style="color:rgba(0,0,0,0.2)">past</b>
                    | 
                    <b style="color:rgba(0,0,0,0.2)">comments</b>
                    | 
                    <a href=<%= ask_contributions_path %>>ask</a> 
                    | 
                    <b style="color:rgba(0,0,0,0.2)">show</b>
                    |
                    <b style="color:rgba(0,0,0,0.2)">jobs</b>
                    | 
                    <a href=<%= new_contribution_path %>>submit</a>            
                  </span>
                </td>
                <td style="text-align:right;padding-right:4px;">
                  <span class="pagetop">
                    <!-- USER -->
                    <% if logged_in? %>
                      <a id='me' href="<%= users_path %>/<%= current_user.id %>"><%= current_user.email %></a> | 
                      <a id='logout' href=<%= logout_path %>>logout</a> 
                    <% else %>
                      <%= link_to 'login', '/auth/google_oauth2', method: :post, :class => 'button'%>
                    <% end %>
                  </span>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr id="pagespace" title="" style="height:10px"></tr>
        <tr>
          <td>
            <table class="fatitem" border="0">
              <tbody>
                <tr class='athing' id=<%= @contribution.id %>>

                  <td valign="top" class="votelinks">
                    <center>

                      <a id=<%= @contribution.id %>>
                        
                        <div class='votearrow' title='upvote'>
                          <%= link_to '.', point_contribution_path(@contribution, :view => "show"), method: :put, :style => "opacity:0" %>
                        </div>

                      </a>
                      
                    </center>
                  </td>
                  <td class="title">
                    <a href=<%= @contribution.id %> class="storylink"><%= @contribution.title %></a>
                  </td>
                </tr>
                
                <tr>
                  <td colspan="1"></td>
                  <td class="subtext">
                    <span class="score" id="score_<%= @contribution.id %>"><%= @contribution.points %> points</span> 
                    by
                    <!-- USER -->
                    <a href="<%= users_path %>/<%= @contribution.user_id %>" class="hnuser"><%= @contribution.user %></a> 
                    <span class="age">
                      <a href=<%= @contribution.id %>><%= distance_of_time_in_words(Time.now.minus_with_coercion(@contribution.created_at).round) %></a>
                    </span>
                    |
                    <!-- falta posar num de comments -->
                    <!-- comments: ha de redireccionar a la pag de la contr  -->
                    <a href=<%= @contribution.id %>>comments</a>
                  </td>
                </tr>
                <tr style="height:2px"></tr>
                <tr>
                  <td colspan="1"></td>
                  <td>
                    <%= @contribution.text %>
                  </td>
                </tr>
                
                <!-- COMMENT -->
                <tr style="height:10px"></tr>
                <tr>
                  <td colspan="1"></td>
                  <td>
                    <%= form_with(model: @comment, url: comments_path) do |form| %>
                        <% if @comment.errors.any? %>
                          <div id="error_explanation">
                            <h2><%= pluralize(@comment.errors.count, "error") %> prohibited this comment from being saved:</h2>
                      
                            <ul>
                              <% @comment.errors.each do |error| %>
                                <li><%= error.full_message %></li>
                              <% end %>
                            </ul>
                          </div>
                        <% end %>
                      
                      <table border="0">
                        <tr>
                          <td style="overflow:hidden;">
                            <div class="field">
                              <%= form.text_area :content, cols: "60", rows: "6" %>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="actions">
                              <% if logged_in? %>
                                <%= hidden_field_tag(:contr_id, @contribution.id) %>
                                <%= form.submit 'add comment' %>
                              <% else %>
                                <i>You need to be logged in to submit a comment: </i>
                                <u><%= link_to 'login', '/auth/google_oauth2', method: :post, :class => 'button'%></u>
                              <% end %>
                            </div>
                          </td>
                        </tr>
                      </table>
                      
                    <% end %>
                  </td>
                </tr>
              </tbody>
            </table>
            <br>
            <br>
            
            <!-- COMMENT TREE -->
            <table border="0" class='comment-tree'>
              <% iteration = 0 %>
              <% Comment.where(contr_id: @contribution.id).each do |comment| %>
                <% iteration += 1 %>
                <tr class='athing comtr'>
                  <table border='0'>
                    <tr>
                      <td valign="top" class="votelinks">
                        <center>
                          <a id=<% comment.id %>>
                            <!-- cal que s'arregli quan es fa el VOTE -->
                            <div class='votearrow' title='upvote'>
                              <%= link_to '.', point_contribution_path(@contribution, :view => "show"), method: :put, :style => "opacity:0" %>
                            </div>
                          </a>
                        </center>
                      </td>
                      
                      <td>
                        <div style="margin-top:2px; margin-bottom:-10px;">
                          
                          <span class="comhead">
                            <a href="<%= users_path %>/<%= comment.user_id %>" class="hnuser"><%=User.find_by(id: comment.user_id).email%></a> 
                            
                            <span class="age">
                              <a href=<%= @contribution.id %>><%= distance_of_time_in_words(Time.now.minus_with_coercion(comment.created_at).round) %></a>
                            </span>
                            
                            <!-- desplegar ?
                            <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 26740742)">[â€“]</a>-->        
                          </span>
                        </div>
                        <br>
                        <div class="comment">
                            <span class="commtext c00">
                               <%= comment.content %>
                            </span>
                            <div class='reply'>
                               <p><font size="1">
                                    <!-- reply porta a una pag /repply on es veu el comment i el formulari de reply a sota -->
                                    <u><a href="reply?id=26740742&amp;goto=item%3Fid%3D26723110%2326740742">reply</a></u>
                                  </font>
                            </div>
                        </div>
                      </td>
                    </tr>
                  <% end %>  
                  </table>
                  
                </tr>
              
            </table>
            
            -----------------------
            <table border="0" class='comment-tree'>
              <tr class='athing comtr'>
                <td>
                   <table border='0'>
                      <tr>
                         <td class='ind'><img src="s.gif" height="1" width="0"></td>
                         <td valign="top" class="votelinks">
                            <center>
                               <a id='up_26740742' onclick='return vote(event, this, "up")' href='vote?id=26740742&amp;how=up&amp;auth=af6809bdd405575d5bbf55393a9bdcf15e5f273f&amp;goto=item%3Fid%3D26723110#26740742'>
                                  <div class='votearrow' title='upvote'></div>
                               </a>
                            </center>
                         </td>
                         <td class="default">
                            <div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
                               <a href="user?id=healeycodes" class="hnuser">healeycodes</a> <span class="age"><a href="item?id=26740742">20 minutes ago</a></span> <span id="unv_26740742"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 26740742)">[â€“]</a>          <span class='storyon'></span>
                               </span>
                            </div>
                            <br>
                            <div class="comment">
                               <span class="commtext c00">
                                  I welcome any improvements to my naive exploration in this article!
                                  <p>I&#x27;ve received two emails from readers:
                                  <p>- One suggested converting RGB to a color space that better matches human visual perception, like CIELAB.
                                  <p>- Another suggested compressing the color space by using K-means clustering (by guessing K as the number of threads)
                               </span>
                               <div class='reply'>
                                  <p><font size="1">
                                     <u><a href="reply?id=26740742&amp;goto=item%3Fid%3D26723110%2326740742">reply</a></u>
                                     </font>
                               </div>
                            </div>
                         </td>
                      </tr>
                   </table>
                </td>
              </tr>
              </table>
            <br>
            <br>
          </td>
        </tr>
        <tr>
          <td bgcolor="#ff6600"></td>
        </tr>
      </table>
    </center>
  </body>
  